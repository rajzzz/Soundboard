# Soundboard Architecture

## Component Overview

```mermaid
classDiagram
    class Soundboard {
        -soundButtonsDiv
        -visualizer
        -bpm
        -glowBar
        -looping
        +createButtons()
        +playSound()
        +toggleLoop()
        +setupLoop()
        +clearLoop()
        +setupHotkeys()
    }
    class BPM {
        -bpm
        -bpmInput
        -bpmUp
        -bpmDown
        +updateBPM()
        +getBPM()
    }
    class GlowBar {
        -glowingLine
        -isLooping
        -pulseAnimation
        +glow()
        +startPulse()
        +stopPulse()
        +singleGlow()
    }
    class Looping {
        -bpm
        +setupLoop()
        +clearLoop()
        +isLooping()
    }
    class WaveformVisualizer {
        -canvas
        -context
        +blendTo()
        +stop()
    }

    Soundboard --> BPM : uses
    Soundboard --> GlowBar : uses
    Soundboard --> Looping : uses
    Soundboard --> WaveformVisualizer : uses
    Looping --> BPM : uses
```

## File Structure

```mermaid
graph TD
    A[index.html] --> B[assets/styles/style.css]
    A --> C[js/main.js]
    C --> D[js/Soundboard.js]
    D --> E[js/BPM.js]
    D --> F[js/GlowBar.js]
    D --> G[js/Looping.js]
    D --> H[js/WaveformVisualizer.js]
    C --> I[js/sounds.js]
    A --> J[sounds/sample/*.wav]
    J --> K[analyze_wavs.py]
    K --> L[precomputed_frequencies.json]
```

## Data Flow

```mermaid
sequenceDiagram
    participant User
    participant Soundboard
    participant BPM
    participant Looping
    participant GlowBar
    participant Audio

    User->>Soundboard: Press/Hold Key or Button
    Soundboard->>Audio: Play Sound
    Soundboard->>GlowBar: Single Glow
    
    opt Hold for Loop
        User->>Soundboard: Hold Key/Button
        Soundboard->>BPM: Get Current BPM
        Soundboard->>Looping: Setup Loop
        loop Every Beat
            Looping->>Audio: Play Sound
            Looping->>GlowBar: Continuous Pulse
        end
    end

    User->>Soundboard: Release/Press Again
    Soundboard->>Looping: Clear Loop
    Soundboard->>GlowBar: Stop Pulse
```

## Key Features

1. **Sound Playback**
   - Single-hit playback with visual feedback
   - Loop creation by holding keys/buttons
   - Multiple sounds can play simultaneously

2. **Visual Feedback**
   - Glow bar pulses with the beat
   - Fill animation when holding for loop
   - Button scaling and color changes
   - Waveform visualization

3. **BPM Control**
   - Adjustable tempo with up/down controls
   - Visual feedback on BPM changes
   - Affects loop timing

4. **User Interface**
   - Keyboard shortcuts for all sounds
   - Visual button grid
   - Hold-to-loop mechanism
   - Clear visual state indicators

## Sound Processing

The system uses precomputed frequency data for visualization, generated by `analyze_wavs.py`. This data is stored in `precomputed_frequencies.json` and used by the WaveformVisualizer for real-time display.

## Event Flow

1. **Button/Key Press:**
   - Play sound immediately
   - Start fill animation
   - Show single glow effect

2. **Hold Detection:**
   - Track hold duration
   - Show fill progress
   - Trigger loop at threshold

3. **Loop Active:**
   - Play sound at BPM intervals
   - Maintain continuous glow effect
   - Scale and highlight active button

4. **Loop End:**
   - Clear intervals
   - Reset visual states
   - Stop glow effects
